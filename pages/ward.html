<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>환자 위치 안내 페이지</title>
    <link rel="stylesheet" href="main.css" />
    <style>
      body {
        font-family: Arial, sans-serif;
      }
      .floor-plan {
        display: grid;
        grid-template-columns: repeat(16, 1fr);
        grid-gap: 2px;
        width: 80%;
        margin: 0 auto;
        background-color: #ddd;
        padding: 10px;
      }
      .room {
        width: 50px;
        background-color: #add8e6;
        height: 60px;
        text-align: center;
        line-height: 60px;
        border: 1px solid #999;
        position: relative;
      }
      .room-62 {
        background-color: #ffa07a;
      }
      .hallway {
        background-color: #fff;
        height: 60px;
        border: 1px solid #999;
      }
      .stairs,
      .elevator {
        background-color: #98fb98;
        width: 50px;
        height: 60px;
        text-align: center;
        line-height: 60px;
        font-weight: bold;
        font-size: 10px;
      }
      .label {
        grid-column: span 16;
        text-align: center;
        font-weight: bold;
        margin: 10px 0;
      }
      .input-container {
        margin: 20px auto;
        text-align: center;
      }
      .arrow {
        width: 0;
        height: 0;
        border-left: 15px solid transparent;
        border-right: 15px solid transparent;
        border-top: 30px solid red; /* 아래를 가리키는 화살표 */
        position: absolute;
        top: -30px; /* 화살표를 병실 위로 배치 */
        left: 50%;
        transform: translateX(-50%);
        display: none; /* 기본적으로 숨김 */
        z-index: 10;
      }

      #keyboardzone {
        /* position: fixed; */
        width: 100%;
        background-color: #f9f9f9;
        border-top: 1px solid #ddd;
        padding: 10px 0;
        box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
        font-size: 20px;
      }
      table {
        margin: 0 auto;
      }
      th {
        padding: 15px;
        background-color: #007bff;
        color: white;
        border-radius: 5px;
        margin: 5px;
        cursor: pointer;
        text-align: center;
      }
      th:hover {
        background-color: #0056b3;
      }
      input {
        width: 80%;
        height: 50px;
        font-size: 20px;
        margin: 20px 0;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }
    </style>
    <script src="https://unpkg.com/hangul-js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const keyboardzone = document.getElementById("keyboardzone");
        const nameInput = document.getElementById("name");
        const ageInput = document.getElementById("age");
        let currentInput = null; // 현재 입력 중인 인풋

        const keyboard = new customKeyboard(
          keyboardzone,
          null,
          null,
          () => console.log("ESC"),
          (text) => console.log("Enter:", text)
        );

        nameInput.addEventListener("click", () => {
          currentInput = nameInput;
          keyboardzone.style.visibility = "visible";
          keyboard.setInput(nameInput);
        });

        ageInput.addEventListener("click", () => {
          currentInput = ageInput;
          keyboardzone.style.visibility = "visible";
          keyboard.setInput(ageInput);
        });

        // 키보드를 숨기거나 표시
        document.addEventListener("click", (event) => {
          if (
            !event.target.closest("#keyboardzone") &&
            !event.target.closest("input")
          ) {
            keyboardzone.style.visibility = "hidden";
          }
        });
      });

      function customKeyboard(zone, input, onClick, onESC, onEnter, form) {
        var nowlang = "koNormal";
        this.setClick = function (newclick) {
          onClick = newclick;
        };
        this.setEnter = function (Enterfun) {
          onEnter = Enterfun;
        };
        this.setZone = function (newZone) {
          zone = newZone;
        };
        var charlist = [];
        this.setInput = function (inputtag) {
          input = inputtag;
          var sub = Hangul.disassemble("" + input.value);
          charlist = sub;
        };
        function getText() {
          return Hangul.assemble(charlist);
        }
        if (form == null) {
          form = {
            koNormal: [
              ["1", "2", "3", "4", "5", "6", "7", "8", "9", "0", "backspace"],
              ["ㅂ", "ㅈ", "ㄷ", "ㄱ", "ㅅ", "ㅛ", "ㅕ", "ㅑ", "ㅐ", "ㅔ"],
              ["ㅁ", "ㄴ", "ㅇ", "ㄹ", "ㅎ", "ㅗ", "ㅓ", "ㅏ", "ㅣ", "enter"],
              ["shift", "ㅋ", "ㅌ", "ㅊ", "ㅍ", "ㅠ", "ㅜ", "ㅡ", "한/영"],
              ["space"],
            ],
          };
        }
        var keydiv = {};
        for (let index = 0; index < Object.keys(form).length; index++) {
          keydiv[Object.keys(form)[index]] = document.createElement("div");
          keydiv[Object.keys(form)[index]].style.cssText = `
            position: relative;
            width: 100%;
            visibility: hidden;
          `;
          for (let i = 0; i < form[Object.keys(form)[index]].length; i++) {
            var keyline = document.createElement("table");
            for (let j = 0; j < form[Object.keys(form)[index]][i].length; j++) {
              var key = document.createElement("th");
              key.innerText = form[Object.keys(form)[index]][i][j];
              key.addEventListener("click", keyfun);
              keyline.appendChild(key);
            }
            keydiv[Object.keys(form)[index]].appendChild(keyline);
          }
          zone.appendChild(keydiv[Object.keys(form)[index]]);
        }
        keydiv[nowlang].style.visibility = "visible";

        function keyfun() {
          if (this.innerText == "backspace") {
            charlist.pop();
          } else if (this.innerText == "space") {
            charlist.push(" ");
          } else {
            charlist.push(this.innerText);
          }
          input.value = getText();
          if (onClick) onClick(getText());
        }
      }

      function playSiren() {
        const sirenAudio = document.getElementById("siren-sound");

        // 오디오 재생
        sirenAudio.play();

        // 5초 후 재생 중단
        setTimeout(() => {
          sirenAudio.pause(); // 재생 중단
          sirenAudio.currentTime = 0; // 오디오를 처음으로 되돌림
        }, 5000); // 5000ms = 5초
      }
      const patientData = {
        "11-01": { name: "김철수", age: 45 },
        "11-02": { name: "박영희", age: 50 },
        "11-03": { name: "최민호", age: 65 },
        "11-04": { name: "정수진", age: 55 },
        "12-01": { name: "이정우", age: 70 },
        "12-02": { name: "황수민", age: 40 },
        "12-03": { name: "임소연", age: 34 },
        "12-04": { name: "안재훈", age: 58 },
        "21-01": { name: "송민재", age: 67 },
        "21-02": { name: "홍수아", age: 50 },
        "21-03": { name: "정하윤", age: 72 },
        "21-04": { name: "박지민", age: 49 },
        "22-01": { name: "고유정", age: 44 },
        "22-02": { name: "서현우", age: 39 },
        "22-03": { name: "문지호", age: 60 },
        "22-04": { name: "최다은", age: 53 },
        "31-01": { name: "권지수", age: 36 },
        "31-02": { name: "장예은", age: 55 },
        "31-03": { name: "배준호", age: 63 },
        "31-04": { name: "윤서진", age: 48 },
        "32-01": { name: "하진우", age: 47 },
        "32-02": { name: "이하나", age: 58 },
        "32-03": { name: "강태윤", age: 29 },
        "32-04": { name: "엄수정", age: 41 },
        "41-01": { name: "오유진", age: 66 },
        "41-02": { name: "황지민", age: 59 },
        "41-03": { name: "조나현", age: 38 },
        "41-04": { name: "심윤호", age: 42 },
        "42-01": { name: "강나율", age: 33 },
        "42-02": { name: "백민지", age: 52 },
        "42-03": { name: "한예림", age: 56 },
        "42-04": { name: "류도현", age: 64 },
        "51-01": { name: "진은서", age: 37 },
        "51-02": { name: "조승우", age: 46 },
        "51-03": { name: "장하은", age: 61 },
        "51-04": { name: "백지호", age: 35 },
        "52-01": { name: "이유찬", age: 40 },
        "52-02": { name: "김서윤", age: 49 },
        "52-03": { name: "정준영", age: 55 },
        "52-04": { name: "박나리", age: 53 },
        "61-01": { name: "홍길동", age: 54 },
        "61-02": { name: "이영희", age: 45 },
        "61-03": { name: "박철수", age: 30 },
        "61-04": { name: "김민수", age: 65 },
        "62-01": { name: "정해인", age: 70 },
        "62-02": { name: "한지민", age: 52 },
        "62-03": { name: "공효진", age: 40 },
        "62-04": { name: "손예진", age: 60 },
      };

      function findPatient() {
        const nameInput = document.getElementById("name").value.trim();
        const ageInput = parseInt(document.getElementById("age").value, 10);
        let foundRoom = null;

        // 특정 병실을 탐색
        for (const [room, data] of Object.entries(patientData)) {
          if (data.name === nameInput && data.age === ageInput) {
            foundRoom = room;
            break;
          }
        }

        // 기존 화살표 제거
        document.querySelectorAll(".arrow").forEach((arrow) => arrow.remove());

        if (foundRoom) {
          const roomElement = document.querySelector(
            `.room[data-room="${foundRoom}"]`
          );
          if (roomElement) {
            const arrow = document.createElement("div");
            arrow.className = "arrow";
            roomElement.prepend(arrow); // 병실 상단에 화살표 추가
            arrow.style.display = "block";
          } else {
            alert("병실 요소를 찾을 수 없습니다.");
          }
        } else {
          alert("입력한 이름과 나이에 해당하는 환자를 찾을 수 없습니다.");
        }
      }
    </script>
  </head>
  <body>
    <header class="header">
      <div class="header-left">
        <a href="main.html">
          <img src="../src/home.jpg" alt="Home Logo" class="logo-header" />
        </a>
      </div>
      <div class="header-right">
        <div class="alert" onclick="playSiren()">직원 호출</div>
        <audio id="siren-sound" src="../src/siren.mp3"></audio>
      </div>
      <!-- 이름 입력과 QWERTY 키보드 -->
      <div class="input-container">
        <label for="name">이름: </label>
        <input id="name" type="text" placeholder="홍길동" />
        <br />
        <label for="age">나이: </label>
        <input id="age" type="number" placeholder="54" />
        <button onclick="findPatient()">찾기</button>
      </div>
      <div id="keyboardzone"></div>
    </header>
    <div class="label">병실 위치 안내</div>
    <div class="floor-plan">
      <div class="stairs">계단</div>
      <div class="room" data-room="61-01">61-01</div>
      <div class="room" data-room="61-02">61-02</div>
      <div class="room" data-room="61-03">61-03</div>
      <div class="room" data-room="61-04">61-04</div>
      <div class="hallway"></div>
      <div class="elevator">엘리베이터</div>
      <div class="hallway"></div>
      <div class="room room-62" data-room="62-01">62-01</div>
      <div class="room room-62" data-room="62-02">62-02</div>
      <div class="room room-62" data-room="62-03">62-03</div>
      <div class="room room-62" data-room="62-04">62-04</div>
      <div class="stairs">계단</div>
    </div>
    <div class="floor-plan">
      <div class="stairs">계단</div>
      <div class="room" data-room="51-01">51-01</div>
      <div class="room" data-room="51-02">51-02</div>
      <div class="room" data-room="51-03">51-03</div>
      <div class="room" data-room="51-04">51-04</div>
      <div class="hallway"></div>
      <div class="elevator">엘리베이터</div>
      <div class="hallway"></div>
      <div class="room" data-room="52-01">52-01</div>
      <div class="room" data-room="52-02">52-02</div>
      <div class="room" data-room="52-03">52-03</div>
      <div class="room" data-room="52-04">52-04</div>
      <div class="stairs">계단</div>
    </div>
    <div class="floor-plan">
      <div class="stairs">계단</div>
      <div class="room" data-room="41-01">41-01</div>
      <div class="room" data-room="41-02">41-02</div>
      <div class="room" data-room="41-03">41-03</div>
      <div class="room" data-room="41-04">41-04</div>
      <div class="hallway"></div>
      <div class="elevator">엘리베이터</div>
      <div class="hallway"></div>
      <div class="room" data-room="42-01">42-01</div>
      <div class="room" data-room="42-02">42-02</div>
      <div class="room" data-room="42-03">42-03</div>
      <div class="room" data-room="42-04">42-04</div>
      <div class="stairs">계단</div>
    </div>
    <div class="floor-plan">
      <div class="stairs">계단</div>
      <div class="room" data-room="31-01">31-01</div>
      <div class="room" data-room="31-02">31-02</div>
      <div class="room" data-room="31-03">31-03</div>
      <div class="room" data-room="31-04">31-04</div>
      <div class="hallway"></div>
      <div class="elevator">엘리베이터</div>
      <div class="hallway"></div>
      <div class="room" data-room="32-01">32-01</div>
      <div class="room" data-room="32-02">32-02</div>
      <div class="room" data-room="32-03">32-03</div>
      <div class="room" data-room="32-04">32-04</div>
      <div class="stairs">계단</div>
    </div>
    <div class="floor-plan">
      <div class="stairs">계단</div>
      <div class="room" data-room="21-01">21-01</div>
      <div class="room" data-room="21-02">21-02</div>
      <div class="room" data-room="21-03">21-03</div>
      <div class="room" data-room="21-04">21-04</div>
      <div class="hallway"></div>
      <div class="elevator">엘리베이터</div>
      <div class="hallway"></div>
      <div class="room" data-room="22-01">22-01</div>
      <div class="room" data-room="22-02">22-02</div>
      <div class="room" data-room="22-03">22-03</div>
      <div class="room" data-room="22-04">22-04</div>
      <div class="stairs">계단</div>
    </div>
    <div class="floor-plan">
      <div class="stairs">계단</div>
      <div class="room" data-room="11-01">11-01</div>
      <div class="room" data-room="11-02">11-02</div>
      <div class="room" data-room="11-03">11-03</div>
      <div class="room" data-room="11-04">11-04</div>
      <div class="hallway"></div>
      <div class="elevator">엘리베이터</div>
      <div class="hallway"></div>
      <div class="room" data-room="12-01">12-01</div>
      <div class="room" data-room="12-02">12-02</div>
      <div class="room" data-room="12-03">12-03</div>
      <div class="room" data-room="12-04">12-04</div>
      <div class="stairs">계단</div>
    </div>

    <footer class="footer">
      <img src="../src/logo.png" alt="Hospital Logo" class="logo" />
      <div class="icons">
        <div class="wrap">
          <img src="../src/돋보기.png" class="magnifying" />
        </div>
        <button class="zoom">+</button>
        <button class="zoom">-</button>
      </div>
    </footer>
  </body>
</html>
